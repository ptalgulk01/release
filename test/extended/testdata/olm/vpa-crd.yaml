apiVersion: template.openshift.io/v1
kind: Template
metadata:
  name: vpa-template
objects:
- kind: CustomResourceDefinition
  apiVersion: apiextensions.k8s.io/v1beta1
  metadata:
    name: "${NAME}"
    annotations:
      "api-approved.kubernetes.io": "https://github.com/kubernetes/kubernetes/pull/63797"
  spec:
    group: autoscaling.k8s.io
    scope: Namespaced
    names:
      plural: verticalpodautoscalers
      singular: verticalpodautoscaler
      kind: VerticalPodAutoscaler
      shortNames:
        - vpa
    version: v1beta1
    versions:
      - name: v1beta1
        served: false
        storage: false
      - name: v1beta2
        served: true
        storage: true
      - name: v1
        served: true
        storage: false
    validation:
      # openAPIV3Schema is the schema for validating custom objects.
      openAPIV3Schema:
        type: object
        properties:
          spec:
            type: object
            required: []
            properties:
              targetRef:
                type: object
              updatePolicy:
                type: object
                properties:
                  updateMode:
                    type: string
              resourcePolicy:
                type: object
                properties:
                  containerPolicies:
                    type: array
                    items:
                      type: object
                      properties:
                        containerName:
                          type: string
                        mode:
                          type: string
                          enum: ["Auto", "Off"]
                        minAllowed:
                          type: object
                        maxAllowed:
                          type: object
                        controlledResources:
                          type: array
                          items:
                            type: string
                            enum: ["cpu", "memory"]
parameters:
- name: NAME
  value: "verticalpodautoscalers.autoscaling.k8s.io"
