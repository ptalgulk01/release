apiVersion: template.openshift.io/v1
kind: Template
metadata:
  name: gcp-machineset-template
objects:
  - apiVersion: machine.openshift.io/v1beta1
    kind: MachineSet
    metadata:
      labels:
        machine.openshift.io/cluster-api-cluster: ${CLUSTERID}
      name: ${NAME}
      namespace: ${NAMESPACE}
    spec:
      replicas: ${{REPLICAS}}
      selector:
        matchLabels:
          machine.openshift.io/cluster-api-cluster: ${CLUSTERID}
          machine.openshift.io/cluster-api-machineset: ${NAME}
      template:
        metadata:
          labels:
            machine.openshift.io/cluster-api-cluster: ${CLUSTERID}
            machine.openshift.io/cluster-api-machine-role: worker
            machine.openshift.io/cluster-api-machine-type: worker
            machine.openshift.io/cluster-api-machineset: ${NAME}
        spec:
          metadata: {}
          taints:
            - effect: "NoSchedule"
              key: "mapi"
              value: "mapi_test"
          providerSpec:
            value:
              apiVersion: gcpprovider.openshift.io/v1beta1
              canIPForward: false
              credentialsSecret:
                name: gcp-cloud-credentials
              deletionProtection: false
              disks:
                - autoDelete: true
                  boot: true
                  image: ${IMAGE}
                  labels: null
                  sizeGb: 128
                  type: pd-ssd
              kind: GCPMachineProviderSpec
              machineType: n1-standard-4
              metadata:
                creationTimestamp: null
              networkInterfaces:
                - network: ${CLUSTERID}-network
                  subnetwork: ${CLUSTERID}-worker-subnet
              projectID: openshift-qe
              region: ${REGION}
              serviceAccounts:
                - email: ${CLUSTERID}-w@openshift-qe.iam.gserviceaccount.com
                  scopes:
                    - https://www.googleapis.com/auth/cloud-platform
              tags:
                - ${CLUSTERID}-worker
              userDataSecret:
                name: worker-user-data
              zone: ${ZONE}
parameters:
  - name: NAME
  - name: NAMESPACE
  - name: CLUSTERID
  - name: REPLICAS
  - name: REGION
  - name: ZONE
  - name: IMAGE
