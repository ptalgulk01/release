apiVersion: template.openshift.io/v1
kind: Template
metadata:
  name: vsphere-machineset-template
objects:
  - apiVersion: machine.openshift.io/v1beta1
    kind: MachineSet
    metadata:
      labels:
        machine.openshift.io/cluster-api-cluster: ${CLUSTERID}
      name: ${NAME}
      namespace: ${NAMESPACE}
    spec:
      replicas: ${{REPLICAS}}
      selector:
        matchLabels:
          machine.openshift.io/cluster-api-cluster: ${CLUSTERID}
          machine.openshift.io/cluster-api-machineset: ${NAME}
      template:
        metadata:
          labels:
            machine.openshift.io/cluster-api-cluster: ${CLUSTERID}
            machine.openshift.io/cluster-api-machine-role: worker
            machine.openshift.io/cluster-api-machine-type: worker
            machine.openshift.io/cluster-api-machineset: ${NAME}
        spec:
          metadata: { }
          taints:
            - effect: "NoSchedule"
              key: "mapi"
              value: "mapi_test"
          providerSpec:
            value:
              apiVersion: vsphereprovider.openshift.io/v1beta1
              credentialsSecret:
                name: vsphere-cloud-credentials
              diskGiB: 120
              kind: VSphereMachineProviderSpec
              memoryMiB: 16384
              metadata:
                creationTimestamp: null
              network:
                devices:
                  - networkName: qe-segment
              numCPUs: 8
              numCoresPerSocket: 1
              snapshot: ""
              template: ${CLUSTERID}-rhcos
              userDataSecret:
                name: worker-user-data
              workspace:
                datacenter: SDDC-Datacenter
                datastore: WorkloadDatastore
                folder: /SDDC-Datacenter/vm/${CLUSTERID}
                resourcePool: /SDDC-Datacenter/host/Cluster-1/Resources
                server: vcenter.sddc-44-236-21-251.vmwarevmc.com
parameters:
  - name: NAME
  - name: NAMESPACE
  - name: CLUSTERID
  - name: REPLICAS
