apiVersion: template.openshift.io/v1
kind: Template
metadata:
  name: peer-pod-secret-aws-template
objects:
  - apiVersion: v1
    kind: Secret
    type: Opaque
    metadata:
      name: "${NAME}"
      namespace: "${NAMESPACE}"
    stringData:
      vxlanPort: "${VXLAN_PORT}"
      cloudProvider: ${CLOUD_PROVIDER}
      cloudRegion: "${CLOUD_REGION}"
      cloudSecret: "${CLOUD_SECRET}"
      podvmImageId: "${PODVM_IMAGE_ID}"
      podvmInstanceType: "${PODVM_INSTANCE_TYPE}"
      AzureSubscriptionId: "${AZURE_SUBSCRIPTION_ID}"
      AzureClientId: "${AZURE_CLIENT_ID}"
      AzureTenantId: "${AZURE_TENANT_ID}"

parameters:
  - name: NAME
    value: "peer-pods-secret"
  - name: NAMESPACE
    value: "openshift-sandboxed-containers-operator"
  - name: VXLAN_PORT
    value: "9000"
  - name: CLOUD_PROVIDER
    value: "azure"
  - name: CLOUD_REGION # AZURE_REGION
    value: "eastus"
  - name: CLOUD_SECRET # AZURE_CLIENT_SECRET
    value: ""
  - name: PODVM_IMAGE_ID # AZURE_IMAGE_ID
    value: ""
  - name: PODVM_INSTANCE_TYPE # AZURE_INSTANCE_SIZE
    value: "Standard_D8as_v5" # optional
  - name: AZURE_SUBSCRIPTION_ID
    value: ""
  - name: AZURE_CLIENT_ID
    value: ""
  - name: AZURE_TENANT_ID
    value: ""
#  - name: AZURE_RESOURCE_GROUP
#    value: ""
#    # AZURE_RESOURCE_GROUP=$(oc get infrastructure/cluster -o jsonpath='{.status.platformStatus.azure.resourceGroupName}')
#  - name: AZURE_SUBNET_ID
#    value: ""
#    # AZURE_VNET_NAME=$(az network vnet list --resource-group $AZURE_RESOURCE_GROUP --query "[].{Name:name}" --output tsv)
#    # AZURE_SUBNET_ID=$(az network vnet subnet list --resource-group $AZURE_RESOURCE_GROUP --vnet-name $AZURE_VNET_NAME  --query "[].{Id:id} | [? contains(Id, 'worker')]" --output tsv)
#  - name: AZURE_NSG_ID
#    value: ""
#    # AZURE_NSG_ID=$(az network nsg list --resource-group $AZURE_RESOURCE_GROUP --query "[].{Id:id}" --output tsv)

# oc process --ignore-unknown-parameters=true -f $L/peer-pod-secret-azure.yaml -p  CLOUD_SECRET="$AZURE_CLIENT_SECRET" PODVM_IMAGE_ID="$AZURE_IMAGE_ID" AZURE_SUBSCRIPTION_ID="$AZURE_SUBSCRIPTION_ID" AZURE_CLIENT_ID="$AZURE_CLIENT_ID" AZURE_TENANT_ID="$AZURE_TENANT_ID"
# This is for Jenkins/end user to create a configmap and apply it to your cluster

